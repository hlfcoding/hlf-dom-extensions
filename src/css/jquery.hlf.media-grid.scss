$hlf-mg-fade-duration: .3s;
$hlf-mg-gutter-size: 6px !default;
$hlf-mg-item-fill-color: #000 !default;
$hlf-mg-item-stroke-color: #fff !default;
$hlf-mg-fill-color: mix($hlf-mg-item-stroke-color, $hlf-mg-item-fill-color, 20%) !default;

%hlf-mg-clearfix {
  &::before,
  &::after {
    content: ' ';
    display: table;
  }

  &::after { clear: both; }
}

%hlf-mg-item-invisible {
  display: none;
  height: 0;
  opacity: 0;
  width: 0;
}

%hlf-mg-item-visible {
  display: block;
  height: auto;
  opacity: 1;
  width: auto;
}

@mixin hlf-media-grid
{
  @extend %hlf-mg-clearfix;

  background: $hlf-mg-fill-color;
  margin: { left: $hlf-mg-gutter-size; top: $hlf-mg-gutter-size; }
  opacity: 0;
  position: relative;
  transition: opacity $hlf-mg-fade-duration ease-in-out;

  // Crucial fix for the unintuitive and inconvenient box model.
  &,
  * { box-sizing: border-box; }

  &.js-mg-ready {
    opacity: 1;
  }
}

@mixin hlf-media-grid-item($height, $width,
                           $dimmed-opacity: .3,
                           $expand-duration: .2s,
                           $expanded-ratio: 2)
{
  background: $hlf-mg-item-fill-color;
  color: $hlf-mg-item-stroke-color;
  float: left; // Becomes none, position-absolute.
  height: $height;
  margin: { bottom: $hlf-mg-gutter-size; right: $hlf-mg-gutter-size; }
  overflow: hidden;
  padding: $hlf-mg-gutter-size;
  transition: {
    duration: $expand-duration;
    property: height, left, opacity, top, width;
    timing-function: ease-in-out;
  }
  width: $width;

  >.preview,
  >.detail {
    overflow: hidden;
    transition: {
      duration: $hlf-mg-fade-duration;
      property: height, opacity, width;
      timing-function: ease-in-out;
    }
  }

  >.preview {
    @extend %hlf-mg-item-visible;
  }

  >.detail {
    @extend %hlf-mg-item-invisible;
  }

  &:hover:not(.js-mg-expanded) {
    background: $hlf-mg-item-stroke-color;
    color: $hlf-mg-item-fill-color;
  }

  &.js-mg-expanded {
    height: ($expanded-ratio * $height) + $hlf-mg-gutter-size;
    width: ($expanded-ratio * $width) + $hlf-mg-gutter-size;
    z-index: 10;

    >.preview {
      @extend %hlf-mg-item-invisible;
    }

    >.detail {
      @extend %hlf-mg-item-visible;
    }
  }

  .js-mg-dimmed>&:not(.js-mg-expanded) {
    opacity: $dimmed-opacity;
  }
}

@mixin hlf-media-grid-item-extras($font-size: 10px, $radius: 4px)
{
  border-radius: $radius;
  font: {
    family: Helvetica, sans-serif;
    size: $font-size;
  }
  line-height: 2em;

  .title {
    font-size: 14px;
    margin: 0;
    padding: 0;
  }

  p {
    line-height: 1.6em;
  }

  .date {
    font-size: $font-size;
    margin: 0;
    padding: 0;
  }

  .tags {
    list-style: none;
    padding-left: 0;

    li {
      display: inline;

      &:not(:last-child)::after {
        content: ',\0020';
      }
    }
  }

  &.js-mg-expanded hgroup {
    @extend %hlf-mg-clearfix;

    >.date {
      float: right;
    }

    >.title {
      float: left;
    }
  }
}
