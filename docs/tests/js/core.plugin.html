<!DOCTYPE html><html lang="en"><head><title>tests/js/core.plugin</title></head><meta http-equiv="Content-Type" content="text/html; charset=utf-8"><meta name="viewport" content="width=device-width, initial-scale=1.0, minimum-scale=1.0, maximum-scale=1.0"><meta name="groc-relative-root" content="../../"><meta name="groc-document-path" content="tests/js/core.plugin"><meta name="groc-project-path" content="tests/js/core.plugin.coffee"><link rel="stylesheet" type="text/css" media="all" href="../../assets/style.css"><script type="text/javascript" src="../../assets/behavior.js"></script><body><div id="meta"><div class="file-path">tests/js/core.plugin.coffee</div></div><div id="document"><div class="segment"><div class="comments "><div class="wrapper"><h1 id="hlf-core-plugin-unit-tests">HLF Core Plugin Unit Tests</h1></div></div></div><div class="segment"><div class="comments "><div class="wrapper"><p><a href="../../../tests/core.unit.html">Page</a></p></div></div><div class="code"><div class="wrapper">define [
  <span class="hljs-string">'jquery'</span>
  <span class="hljs-string">'underscore'</span>
  <span class="hljs-string">'hlf/jquery.extension.hlf.core'</span>
  <span class="hljs-string">'test/base'</span>
], <span class="hljs-function"><span class="hljs-params">($, _, hlf)</span> -&gt;</span>

  <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">SomePlugin</span></span>
    <span class="hljs-attribute">constructor</span>: <span class="hljs-function"><span class="hljs-params">(<span class="hljs-property">@$el</span>, options, <span class="hljs-property">@$context</span>)</span> -&gt;</span>

  QUnit.<span class="hljs-built_in">module</span> <span class="hljs-string">'plugin'</span>,
    <span class="hljs-attribute">setup</span>: <span class="hljs-function">-&gt;</span>
      <span class="hljs-property">@namespace</span> = 
        <span class="hljs-attribute">debug</span>: <span class="hljs-literal">off</span>
        <span class="hljs-attribute">toString</span>: _.memoize (context) -&gt;
          <span class="hljs-keyword">switch</span> context
            <span class="hljs-keyword">when</span> <span class="hljs-string">'event'</span> <span class="hljs-keyword">then</span> <span class="hljs-string">'.some-plugin'</span>
            <span class="hljs-keyword">when</span> <span class="hljs-string">'data'</span>  <span class="hljs-keyword">then</span> <span class="hljs-string">'some-plugin'</span>
            <span class="hljs-keyword">else</span> <span class="hljs-string">'somePlugin'</span>
        <span class="hljs-attribute">defaults</span>:
          <span class="hljs-attribute">someOption</span>: <span class="hljs-string">'foo'</span>
          <span class="hljs-attribute">someOptionGroup</span>:
            <span class="hljs-attribute">someOption</span>: <span class="hljs-string">'bar'</span>
          <span class="hljs-attribute">selectors</span>: 
            <span class="hljs-attribute">someElement</span>: <span class="hljs-string">'.foo'</span>
          <span class="hljs-attribute">classNames</span>:
            <span class="hljs-attribute">someElement</span>: <span class="hljs-string">'foo'</span>

      <span class="hljs-property">@mixins</span> = {}

      $.createMixin <span class="hljs-property">@mixins</span>, <span class="hljs-string">'base'</span>,
        <span class="hljs-attribute">init</span>: <span class="hljs-function">-&gt;</span>
          <span class="hljs-property">@trigger</span> <span class="hljs-string">'did-init'</span>
          <span class="hljs-keyword">return</span>

      $.createMixin <span class="hljs-property">@mixins</span>, <span class="hljs-string">'someMixin'</span>,
        <span class="hljs-attribute">decorate</span>: <span class="hljs-function">-&gt;</span>
          <span class="hljs-property">@on</span> <span class="hljs-string">'did-init'</span>, <span class="hljs-function">=&gt;</span> <span class="hljs-property">@initSomeMixin</span>()
          <span class="hljs-keyword">return</span>
        <span class="hljs-attribute">initSomeMixin</span>: <span class="hljs-function">-&gt;</span>
          <span class="hljs-property">@someMixinProperty</span> = <span class="hljs-string">'foo'</span>
          <span class="hljs-keyword">return</span>
        <span class="hljs-attribute">someMixinMethod</span>: <span class="hljs-function">-&gt;</span> <span class="hljs-string">'foo'</span>

      $.createMixin <span class="hljs-property">@mixins</span>, <span class="hljs-string">'someOtherMixin'</span>,
        <span class="hljs-attribute">decorate</span>: <span class="hljs-function">-&gt;</span>
          <span class="hljs-property">@on</span> <span class="hljs-string">'did-init'</span>, <span class="hljs-function">=&gt;</span> <span class="hljs-property">@initSomeOtherMixin</span>()
          <span class="hljs-keyword">return</span>
        <span class="hljs-attribute">initSomeOtherMixin</span>: <span class="hljs-function">-&gt;</span>
          <span class="hljs-property">@someOtherMixinProperty</span> = <span class="hljs-string">'bar'</span>
          <span class="hljs-keyword">return</span>
        <span class="hljs-attribute">someOtherMixinMethod</span>: <span class="hljs-function">-&gt;</span> <span class="hljs-string">'bar'</span>

      <span class="hljs-property">@baseCreateOptions</span> = 
        <span class="hljs-attribute">name</span>: <span class="hljs-string">'somePlugin'</span>
        <span class="hljs-attribute">namespace</span>: <span class="hljs-property">@namespace</span>
        <span class="hljs-attribute">apiClass</span>: SomePlugin
        <span class="hljs-attribute">baseMixins</span>: [<span class="hljs-string">'selection'</span>]
        <span class="hljs-attribute">autoSelect</span>: <span class="hljs-literal">yes</span>
        <span class="hljs-attribute">compactOptions</span>: <span class="hljs-literal">yes</span>

      <span class="hljs-property">@$someElement</span> = $ <span class="hljs-string">'&lt;div&gt;'</span>
      <span class="hljs-keyword">return</span>
<span class="hljs-function">
  <span class="hljs-title">assertGeneralPlugin</span> = <span class="hljs-params">(assert)</span> -&gt;</span>
    assert.ok <span class="hljs-property">@$someElement</span>.somePlugin,
      <span class="hljs-string">'Plugin method should have been created and attached to jQuery elements.'</span>
    <span class="hljs-property">@$someElement</span>.somePlugin()
    result = <span class="hljs-property">@$someElement</span>.somePlugin()
    assert.hasFunctions result, [<span class="hljs-string">'evt'</span>, <span class="hljs-string">'attr'</span>, <span class="hljs-string">'cls'</span>, <span class="hljs-string">'debugLog'</span>, <span class="hljs-string">'select'</span>],
      <span class="hljs-string">'Plugin instance should have generated API additions.'</span>
    assert.hasOwnProperties result, _.keys(<span class="hljs-property">@namespace</span>.defaults),
      <span class="hljs-string">'Plugin instance should have options merged in as properties.'</span>
    assert.ok result.$someElement,
      <span class="hljs-string">'Plugin instance should have auto-selected sub elements based on selectors option.'</span>
    result

  QUnit.test <span class="hljs-string">'createPlugin with apiClass and baseMixins'</span>, <span class="hljs-function"><span class="hljs-params">(assert)</span> -&gt;</span>
    hlf.createPlugin <span class="hljs-property">@baseCreateOptions</span>
    result = assertGeneralPlugin.call @, assert
    assert.ok result <span class="hljs-keyword">instanceof</span> SomePlugin,
      <span class="hljs-string">'Plugin method should return instance upon re-invocation without any parameters.'</span>
    <span class="hljs-keyword">return</span>

  QUnit.test <span class="hljs-string">'createPlugin with apiMixins and baseMixins'</span>, <span class="hljs-function"><span class="hljs-params">(assert)</span> -&gt;</span>
    createOptions = <span class="hljs-property">@baseCreateOptions</span>
    createOptions.apiClass = <span class="hljs-literal">null</span>
    createOptions.apiMixins = <span class="hljs-property">@mixins</span>
    createOptions.baseMixins.push <span class="hljs-string">'data'</span>, <span class="hljs-string">'event'</span>
    hlf.createPlugin createOptions
    result = assertGeneralPlugin.call @, assert
    assert.hasFunctions result, [<span class="hljs-string">'data'</span>, <span class="hljs-string">'on'</span>, <span class="hljs-string">'off'</span>, <span class="hljs-string">'trigger'</span>],
      <span class="hljs-string">'Base mixin methods should have been added to instance.'</span>
    assert.strictEqual result.someMixinMethod(), <span class="hljs-string">'foo'</span>,
      <span class="hljs-string">'Mixin method attached to instance should work.'</span>
    assert.strictEqual result.someOtherMixinMethod(), <span class="hljs-string">'bar'</span>,
      <span class="hljs-string">'Mixin method attached to instance should work.'</span>
    assert.strictEqual result.someMixinProperty, <span class="hljs-string">'foo'</span>,
      <span class="hljs-string">'Mixin property should have been set on deferred initialization.'</span>
    assert.strictEqual result.someOtherMixinProperty, <span class="hljs-string">'bar'</span>,
      <span class="hljs-string">'Mixin property should have been set on deferred initialization.'</span>
    <span class="hljs-keyword">return</span>

  QUnit.test <span class="hljs-string">'createPlugin with apiClass and baseMixins and asSharedInstance'</span>, <span class="hljs-function"><span class="hljs-params">(assert)</span> -&gt;</span>
    createOptions = <span class="hljs-property">@baseCreateOptions</span>
    createOptions.asSharedInstance = <span class="hljs-literal">yes</span>
    hlf.createPlugin createOptions
    result = assertGeneralPlugin.call @, assert
    assert.strictEqual result, $(<span class="hljs-string">'body'</span>).data(<span class="hljs-string">'somePlugin'</span>),
      <span class="hljs-string">'Plugin singleton should be stored with context element.'</span>
    <span class="hljs-keyword">return</span>

  <span class="hljs-literal">yes</span></div></div></div></div></body></html>