<!DOCTYPE html><html lang="en"><head><title>tests/js/media-grid</title></head><meta http-equiv="Content-Type" content="text/html; charset=utf-8"><meta name="viewport" content="width=device-width, initial-scale=1.0, minimum-scale=1.0, maximum-scale=1.0"><meta name="groc-relative-root" content="../../"><meta name="groc-document-path" content="tests/js/media-grid"><meta name="groc-project-path" content="tests/js/media-grid.js"><link rel="stylesheet" type="text/css" media="all" href="../../assets/style.css"><script type="text/javascript" src="../../assets/behavior.js"></script><body><div id="meta"><div class="file-path">tests/js/media-grid.js</div></div><div id="document"><div class="segment"><div class="comments "><div class="wrapper"><h1 id="hlf-media-grid-visual-tests">HLF Media Grid Visual Tests</h1>
<p><a href="../../../tests/media-grid.visual.html">Page</a> | <a href="../../src/js/media-grid.html">Source</a></p></div></div><div class="code"><div class="wrapper">(<span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span> </span>{
<span class="hljs-pi">  'use strict'</span>;
  <span class="hljs-keyword">if</span> (<span class="hljs-built_in">window</span>.guard &amp;&amp; !guard.isNavigatorSupported) { <span class="hljs-keyword">return</span>; }

  <span class="hljs-built_in">require</span>.config({ baseUrl: <span class="hljs-string">'../'</span>, paths: { hlf: <span class="hljs-string">'dist'</span>, test: <span class="hljs-string">'tests/js'</span> } });
  define([<span class="hljs-string">'test/base'</span>, <span class="hljs-string">'hlf/media-grid'</span>], <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(base, MediaGrid)</span> </span>{
    <span class="hljs-keyword">if</span> (<span class="hljs-built_in">window</span>.QUnit) {
      <span class="hljs-keyword">const</span> { <span class="hljs-built_in">module</span>, test } = QUnit;
      <span class="hljs-built_in">module</span>(<span class="hljs-string">'HLF.MediaGrid'</span>, {
        beforeEach() {
          <span class="hljs-keyword">let</span> element = <span class="hljs-built_in">document</span>.createElement(<span class="hljs-string">'div'</span>);
          element.innerHTML = (
`&lt;div&gt;
  <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-title">div</span> <span class="hljs-attribute">class</span>=<span class="hljs-value">"js-mg-item"</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-title">div</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-title">div</span> <span class="hljs-attribute">class</span>=<span class="hljs-value">"js-mg-item"</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-title">div</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-title">div</span> <span class="hljs-attribute">class</span>=<span class="hljs-value">"js-mg-item"</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-title">div</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-title">div</span>&gt;</span>`
          );
          document.getElementById('qunit-fixture').appendChild(element);
          this.mediaGrid = MediaGrid.extend(element);
        },
      });
      test('#_updateMetrics', function(assert) {
        const { mediaGrid } = this;
        let { style } = mediaGrid.element;
        style.boxSizing = 'border-box';
        style.padding = '10px';
        mediaGrid.itemElements.forEach((itemElement) =&gt; {
          let { style } = itemElement;
          style.borderWidth = '1px';
          style.boxSizing = 'border-box';
          style.marginRight = '10px';
          style.padding = '9px';
          style.width = style.height = '200px';
        });
        style = mediaGrid.element.parentElement.style;
        style.width = '610px';
        let metrics;
        mediaGrid._updateMetrics({ hard: true });
        metrics = mediaGrid.metrics;
        assert.strictEqual(metrics.gutter, 10, 'It bases gutter on item margin sizes.');
        assert.strictEqual(metrics.itemWidth, 200, "It uses the item's 'outerWidth' as width.");
        assert.strictEqual(metrics.rowSize, 2, 'It bases row size on item and wrap sizes.');
        assert.strictEqual(metrics.colSize, 2, 'It bases column size on row size.');
        style.width = '620px';
        mediaGrid._updateMetrics({ hard: true });
        metrics = mediaGrid.metrics;
        assert.strictEqual(metrics.rowSize, 3, 'It bases row size on item and wrap sizes.');
        assert.strictEqual(mediaGrid.selectAllByClass('samples').length, 1,
          'It cleans up after multiple hard updates.');
      });
      QUnit.start();
      return true;
    }
</span></div></div></div><div class="segment"><div class="comments "><div class="wrapper"><hr></div></div><div class="code"><div class="wrapper">    <span class="hljs-keyword">let</span> tests = [];
    <span class="hljs-keyword">const</span> { createVisualTest, placeholderText, runVisualTests } = base;
    <span class="hljs-keyword">const</span> { className, eventName } = MediaGrid;
    tests.push(createVisualTest({
      label: <span class="hljs-string">'by default'</span>,
      template({ placeholderText }) {
        <span class="hljs-keyword">const</span> tagsHTML = (
`&lt;ul <span class="hljs-keyword">class</span>=<span class="hljs-string">"mg-tags"</span>&gt;
  <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-title">li</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-title">a</span> <span class="hljs-attribute">href</span>=<span class="hljs-value">"#"</span>&gt;</span>foo<span class="hljs-tag">&lt;/<span class="hljs-title">a</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-title">li</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-title">li</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-title">a</span> <span class="hljs-attribute">href</span>=<span class="hljs-value">"#"</span>&gt;</span>bar<span class="hljs-tag">&lt;/<span class="hljs-title">a</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-title">li</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-title">li</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-title">a</span> <span class="hljs-attribute">href</span>=<span class="hljs-value">"#"</span>&gt;</span>baz<span class="hljs-tag">&lt;/<span class="hljs-title">a</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-title">li</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-title">ul</span>&gt;</span>`
        );
        const title = placeholderText.title.toUpperCase();
        let html = '<span class="hljs-tag">&lt;<span class="hljs-title">div</span> <span class="hljs-attribute">class</span>=<span class="hljs-value">"test-body mg-bleed mg-theme-folio"</span>&gt;</span>';
        let i = 12;
        do {
          html += (
`<span class="hljs-tag">&lt;<span class="hljs-title">article</span> <span class="hljs-attribute">class</span>=<span class="hljs-value">"js-mg-item"</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-title">section</span> <span class="hljs-attribute">class</span>=<span class="hljs-value">"mg-preview"</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-title">img</span> <span class="hljs-attribute">src</span>=<span class="hljs-value">"http://placehold.it/200x134/888/aaa"</span> <span class="hljs-attribute">alt</span>=<span class="hljs-value">"preview thumbnail"</span> /&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-title">div</span> <span class="hljs-attribute">class</span>=<span class="hljs-value">"mg-headings"</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-title">h1</span> <span class="hljs-attribute">class</span>=<span class="hljs-value">"mg-title"</span>&gt;</span>${title}<span class="hljs-tag">&lt;/<span class="hljs-title">h1</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-title">h2</span> <span class="hljs-attribute">class</span>=<span class="hljs-value">"mg-date"</span>&gt;</span>July 2012<span class="hljs-tag">&lt;/<span class="hljs-title">h2</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-title">div</span>&gt;</span>
    ${tagsHTML}
  <span class="hljs-tag">&lt;/<span class="hljs-title">section</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-title">section</span> <span class="hljs-attribute">class</span>=<span class="hljs-value">"mg-detail"</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-title">img</span> <span class="hljs-attribute">src</span>=<span class="hljs-value">"http://placehold.it/418x280/888/aaa"</span> <span class="hljs-attribute">alt</span>=<span class="hljs-value">"main banner"</span> /&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-title">div</span> <span class="hljs-attribute">class</span>=<span class="hljs-value">"mg-headings"</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-title">h1</span> <span class="hljs-attribute">class</span>=<span class="hljs-value">"mg-title"</span>&gt;</span>${title}<span class="hljs-tag">&lt;/<span class="hljs-title">h1</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-title">h2</span> <span class="hljs-attribute">class</span>=<span class="hljs-value">"mg-date"</span>&gt;</span>July 2012<span class="hljs-tag">&lt;/<span class="hljs-title">h2</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-title">div</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-title">p</span>&gt;</span>${placeholderText.short}<span class="hljs-tag">&lt;/<span class="hljs-title">p</span>&gt;</span>
    ${tagsHTML}
  <span class="hljs-tag">&lt;/<span class="hljs-title">section</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-title">article</span>&gt;</span>`
          );
        } while ((i -= 1));
        html += '<span class="hljs-tag">&lt;/<span class="hljs-title">div</span>&gt;</span>';
        return html;
      },
      footerHtml: '<span class="hljs-tag">&lt;<span class="hljs-title">button</span> <span class="hljs-attribute">name</span>=<span class="hljs-value">"list-append"</span>&gt;</span>load more<span class="hljs-tag">&lt;/<span class="hljs-title">button</span>&gt;</span>',
      test(testElement) {
        let mediaGrid = MediaGrid.extend(testElement.querySelector('.test-body'));
        const { load } = mediaGrid;
        return mediaGrid.createPreviewImagesPromise().then(load, load);
      },
      anchorName: 'default',
      className: 'default-call',
      vars: { placeholderText },
      beforeTest(testElement) {
        testElement.addEventListener(eventName('ready'), (_) =&gt; {
          createVisualTest.setupAppendButton({
            testElement,
            listSelector: '.test-body',
            itemSelector: 'article:last-of-type',
            onAppend(newElement) {
              newElement.classList.add(className('raw'));
            },
          });
        });
      },
    }));
    runVisualTests(tests);
  });

}());
</span></div></div></div></div></body></html>