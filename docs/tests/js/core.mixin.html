<!DOCTYPE html><html lang="en"><head><title>tests/js/core.mixin</title></head><meta http-equiv="Content-Type" content="text/html; charset=utf-8"><meta name="viewport" content="width=device-width, initial-scale=1.0, minimum-scale=1.0, maximum-scale=1.0"><meta name="groc-relative-root" content="../../"><meta name="groc-document-path" content="tests/js/core.mixin"><meta name="groc-project-path" content="tests/js/core.mixin.coffee"><link rel="stylesheet" type="text/css" media="all" href="../../assets/style.css"><script type="text/javascript" src="../../assets/behavior.js"></script><body><div id="meta"><div class="file-path">tests/js/core.mixin.coffee</div></div><div id="document"><div class="segment"><div class="comments "><div class="wrapper"><h1 id="hlf-core-mixin-unit-tests">HLF Core Mixin Unit Tests</h1></div></div></div><div class="segment"><div class="comments "><div class="wrapper"><p><a href="../../../tests/core.unit.html">Page</a></p></div></div><div class="code"><div class="wrapper">define [
  <span class="hljs-string">'jquery'</span>
  <span class="hljs-string">'underscore'</span>
  <span class="hljs-string">'hlf/jquery.extension.hlf.core'</span>
  <span class="hljs-string">'test/base'</span>
], <span class="hljs-function"><span class="hljs-params">($, _, hlf)</span> -&gt;</span>
  <span class="hljs-string">'use strict'</span>

  {<span class="hljs-built_in">module</span>, test} = QUnit

  <span class="hljs-built_in">module</span> <span class="hljs-string">'mixin core'</span>,
    <span class="hljs-attribute">beforeEach</span>: <span class="hljs-function">-&gt;</span>
      <span class="hljs-property">@mixins</span> = {}
      <span class="hljs-property">@mixin</span> =
        <span class="hljs-attribute">decorate</span>: <span class="hljs-function">-&gt;</span>
          <span class="hljs-property">@someOtherProperty</span> = <span class="hljs-string">'baz'</span>
          <span class="hljs-keyword">return</span>
        <span class="hljs-attribute">someMethod</span>: <span class="hljs-function">-&gt;</span> <span class="hljs-string">'foo'</span>
        <span class="hljs-attribute">someProperty</span>: <span class="hljs-string">'bar'</span>
      <span class="hljs-property">@dynamicMixin</span> = <span class="hljs-function"><span class="hljs-params">(dependencies)</span> -&gt;</span>
        <span class="hljs-attribute">someMethod</span>: <span class="hljs-function">-&gt;</span> dependencies.valueA
        <span class="hljs-attribute">someProperty</span>: dependencies.valueB
      <span class="hljs-property">@mixinName</span> = <span class="hljs-string">'foo'</span>
      <span class="hljs-property">@dynamicMixinName</span> = <span class="hljs-string">'bar'</span>
      <span class="hljs-property">@instance</span> = {}
      <span class="hljs-property">@dependencies</span> =
        <span class="hljs-attribute">valueA</span>: <span class="hljs-string">'foo'</span>
        <span class="hljs-attribute">valueB</span>: <span class="hljs-string">'bar'</span>
      <span class="hljs-keyword">return</span>

  test <span class="hljs-string">'.createMixin'</span>, <span class="hljs-function"><span class="hljs-params">(assert)</span> -&gt;</span>
    result = hlf.createMixin <span class="hljs-property">@mixins</span>, <span class="hljs-property">@mixinName</span>, <span class="hljs-property">@mixin</span>
    assert.strictEqual result, <span class="hljs-property">@mixin</span>,
      <span class="hljs-string">'Mixin is added to mixin collection.'</span>
    assert.strictEqual <span class="hljs-property">@mixins</span>[<span class="hljs-property">@mixinName</span>], <span class="hljs-property">@mixin</span>,
      <span class="hljs-string">'Mixin is accessible.'</span>
    assert.strictEqual <span class="hljs-property">@mixins</span>[<span class="hljs-property">@mixinName</span>].someMethod.mixin, <span class="hljs-property">@mixinName</span>,
      <span class="hljs-string">'Mixin method has mixin name attached.'</span>
    result = hlf.createMixin <span class="hljs-property">@mixins</span>, <span class="hljs-property">@mixinName</span>, <span class="hljs-property">@mixin</span>
    assert.strictEqual result, <span class="hljs-literal">no</span>,
      <span class="hljs-string">'Mixin is not re-added to mixin collection.'</span>
    <span class="hljs-keyword">return</span>
<span class="hljs-function">
  <span class="hljs-title">assertMixinInstance</span> = <span class="hljs-params">(assert)</span> -&gt;</span>
    assert.ok <span class="hljs-property">@instance</span>.someMethod,
      <span class="hljs-string">'Mixin method is added to instance.'</span>
    assert.strictEqual <span class="hljs-property">@instance</span>.someMethod(), <span class="hljs-string">'foo'</span>,
      <span class="hljs-string">'Mixin method is generated properly.'</span>
    assert.strictEqual <span class="hljs-property">@instance</span>.decorate, <span class="hljs-literal">undefined</span>,
      <span class="hljs-string">'Mixin once method is removed after invoking.'</span>
    assert.strictEqual <span class="hljs-property">@instance</span>.someOtherProperty, <span class="hljs-string">'baz'</span>,
      <span class="hljs-string">'Mixin once method is invoked properly.'</span>
    <span class="hljs-keyword">return</span>

  test <span class="hljs-string">'.applyMixins'</span>, <span class="hljs-function"><span class="hljs-params">(assert)</span> -&gt;</span>
    result = hlf.createMixin <span class="hljs-property">@mixins</span>, <span class="hljs-property">@mixinName</span>, <span class="hljs-property">@mixin</span>
    hlf.applyMixins <span class="hljs-property">@instance</span>, <span class="hljs-property">@dependencies</span>, <span class="hljs-property">@mixin</span>
    assertMixinInstance.call @, assert
    <span class="hljs-keyword">return</span>
<span class="hljs-function">
  <span class="hljs-title">assertDynamicMixinInstance</span> = <span class="hljs-params">(assert)</span> -&gt;</span>
    assert.ok <span class="hljs-property">@instance</span>.someMethod,
      <span class="hljs-string">'Dynamic mixin method is added to instance.'</span>
    assert.strictEqual <span class="hljs-property">@instance</span>.someMethod(), <span class="hljs-property">@dependencies</span>.valueA,
      <span class="hljs-string">'Dynamic mixin method is generated properly.'</span>
    <span class="hljs-keyword">return</span>

  test <span class="hljs-string">'.applyMixins with dynamicMixin'</span>, <span class="hljs-function"><span class="hljs-params">(assert)</span> -&gt;</span>
    result = hlf.createMixin <span class="hljs-property">@mixins</span>, <span class="hljs-property">@dynamicMixinName</span>, <span class="hljs-property">@dynamicMixin</span>
    hlf.applyMixins <span class="hljs-property">@instance</span>, <span class="hljs-property">@dependencies</span>, <span class="hljs-property">@dynamicMixin</span>
    assertDynamicMixinInstance.call @, assert
    <span class="hljs-keyword">return</span>

  test <span class="hljs-string">'.applyMixins'</span>, <span class="hljs-function"><span class="hljs-params">(assert)</span> -&gt;</span>
    hlf.createMixin <span class="hljs-property">@mixins</span>, <span class="hljs-property">@mixinName</span>, <span class="hljs-property">@mixin</span>
    hlf.createMixin <span class="hljs-property">@mixins</span>, <span class="hljs-property">@dynamicMixinName</span>, <span class="hljs-property">@dynamicMixin</span>
    hlf.applyMixins <span class="hljs-property">@instance</span>, <span class="hljs-property">@dependencies</span>, _.values(<span class="hljs-property">@mixins</span>)...
    assertMixinInstance.call @, assert
    assertDynamicMixinInstance.call @, assert
    <span class="hljs-keyword">return</span>

  <span class="hljs-built_in">module</span> <span class="hljs-string">'hlf.mixins.data'</span>,
    <span class="hljs-attribute">beforeEach</span>: <span class="hljs-function">-&gt;</span>
      <span class="hljs-property">@instance</span> =
        <span class="hljs-attribute">attr</span>: <span class="hljs-function"><span class="hljs-params">(name)</span> -&gt;</span> <span class="hljs-string">"some-ns-<span class="hljs-subst">#{name}</span>"</span>
        <span class="hljs-attribute">$el</span>: $ <span class="hljs-string">'&lt;div&gt;'</span>
      hlf.applyMixin <span class="hljs-property">@instance</span>, [], <span class="hljs-string">'data'</span>
      <span class="hljs-keyword">return</span>

  test <span class="hljs-string">'#data'</span>, <span class="hljs-function"><span class="hljs-params">(assert)</span> -&gt;</span>
    <span class="hljs-property">@instance</span>.$el.data <span class="hljs-string">'some-ns-some-attr'</span>, <span class="hljs-string">'some-value'</span>
    assert.strictEqual <span class="hljs-property">@instance</span>.data(<span class="hljs-string">'some-attr'</span>), <span class="hljs-string">'some-value'</span>,
      <span class="hljs-string">'It namespaces key and gets value for single key via $.fn.data.'</span>

    <span class="hljs-property">@instance</span>.data <span class="hljs-string">'some-attr'</span>, <span class="hljs-string">'some-value'</span>
    assert.strictEqual <span class="hljs-property">@instance</span>.$el.data(<span class="hljs-string">'some-ns-some-attr'</span>), <span class="hljs-string">'some-value'</span>,
      <span class="hljs-string">'It namespaces key and sets value for single key via $.fn.data.'</span>

    pairs = { <span class="hljs-string">'some-attr'</span>: <span class="hljs-string">'some-value'</span>, <span class="hljs-string">'other-attr'</span>: <span class="hljs-string">'other-value'</span> }
    <span class="hljs-property">@instance</span>.data pairs
    <span class="hljs-keyword">for</span> own key, value <span class="hljs-keyword">of</span> pairs
      assert.strictEqual <span class="hljs-property">@instance</span>.$el.data(<span class="hljs-string">"some-ns-<span class="hljs-subst">#{key}</span>"</span>), value,
        <span class="hljs-string">'It namespaces keys and sets values in pairs object via $.fn.data.'</span>
    <span class="hljs-keyword">return</span>

  <span class="hljs-built_in">module</span> <span class="hljs-string">'hlf.mixins.event'</span>,
    <span class="hljs-attribute">beforeEach</span>: <span class="hljs-function">-&gt;</span>
      additions = hlf._createPluginAPIAdditions <span class="hljs-string">'some-plugin'</span>,
        { <span class="hljs-attribute">toString</span>: <span class="hljs-function">-&gt;</span> <span class="hljs-string">'.some-ns'</span> }
      <span class="hljs-property">@instance</span> =
        <span class="hljs-attribute">evt</span>: additions.evt
        <span class="hljs-attribute">$el</span>: $ <span class="hljs-string">'&lt;div&gt;&lt;div&gt;&lt;/div&gt;&lt;/div&gt;'</span>
      hlf.applyMixin <span class="hljs-property">@instance</span>, [], <span class="hljs-string">'event'</span>
      <span class="hljs-keyword">return</span>

  test <span class="hljs-string">"#on"</span>, <span class="hljs-function"><span class="hljs-params">(assert)</span> -&gt;</span>
    assert.expect <span class="hljs-number">10</span>

    <span class="hljs-property">@instance</span>.<span class="hljs-literal">on</span> <span class="hljs-string">'some-event other-event'</span>, <span class="hljs-function"><span class="hljs-params">(e)</span> -&gt;</span>
      assert.ok e, <span class="hljs-string">'It namespaces, binds event(s) with handler via $.fn.on.'</span>
      <span class="hljs-keyword">return</span>
    <span class="hljs-property">@instance</span>.$el.trigger(<span class="hljs-string">'some-event.some-ns'</span>).trigger(<span class="hljs-string">'other-event.some-ns'</span>)
      .<span class="hljs-literal">off</span>() <span class="hljs-comment"># 2</span>
<span class="hljs-function">
    <span class="hljs-title">handler</span> = <span class="hljs-params">(e)</span> -&gt;</span>
      assert.ok e, <span class="hljs-string">'It namespaces, binds from event(s)-handler map via $.fn.on.'</span>
      <span class="hljs-keyword">return</span>
    <span class="hljs-property">@instance</span>.<span class="hljs-literal">on</span> { <span class="hljs-string">'some-event'</span>: handler, <span class="hljs-string">'other-event'</span>: handler }
    <span class="hljs-property">@instance</span>.$el.trigger(<span class="hljs-string">'some-event.some-ns'</span>).trigger(<span class="hljs-string">'other-event.some-ns'</span>)
      .<span class="hljs-literal">off</span>() <span class="hljs-comment"># 2</span>
<span class="hljs-function">
    <span class="hljs-title">handler</span> = <span class="hljs-params">(e, data)</span> -&gt;</span>
      assert.ok e, <span class="hljs-string">'It supports selector filter (event delegation) via $.fn.on.'</span>
      assert.strictEqual data, <span class="hljs-string">'some-value'</span>,
        <span class="hljs-string">'It supports event data via $.fn.on.'</span>
      <span class="hljs-keyword">return</span>
    <span class="hljs-property">@instance</span>.<span class="hljs-literal">on</span> <span class="hljs-string">'some-event'</span>, <span class="hljs-string">'div'</span>, handler
    <span class="hljs-property">@instance</span>.$el.find(<span class="hljs-string">'div'</span>)
      .trigger(<span class="hljs-string">'some-event.some-ns'</span>, <span class="hljs-string">'some-value'</span>)
      .end().<span class="hljs-literal">off</span>() <span class="hljs-comment"># 2</span>
    <span class="hljs-property">@instance</span>.<span class="hljs-literal">on</span> { <span class="hljs-string">'some-event'</span>: handler, <span class="hljs-string">'other-event'</span>: handler }, <span class="hljs-string">'div'</span>
    <span class="hljs-property">@instance</span>.$el.find(<span class="hljs-string">'div'</span>)
      .trigger(<span class="hljs-string">'some-event.some-ns'</span>, <span class="hljs-string">'some-value'</span>)
      .trigger(<span class="hljs-string">'other-event.some-ns'</span>, <span class="hljs-string">'some-value'</span>)
      .end().<span class="hljs-literal">off</span>() <span class="hljs-comment"># 4</span>
    <span class="hljs-keyword">return</span>

  test <span class="hljs-string">'#off'</span>, <span class="hljs-function"><span class="hljs-params">(assert)</span> -&gt;</span>
    handled = 
      <span class="hljs-string">'some-event.some-ns'</span>: <span class="hljs-number">0</span>
      <span class="hljs-string">'other-event.some-ns'</span>: <span class="hljs-number">0</span>
      <span class="hljs-attribute">total</span>: <span class="hljs-function">-&gt;</span> @[<span class="hljs-string">'some-event.some-ns'</span>] + @[<span class="hljs-string">'other-event.some-ns'</span>]
<span class="hljs-function">    <span class="hljs-title">handler</span> = <span class="hljs-params">(e)</span> -&gt;</span>
      handled[<span class="hljs-string">"<span class="hljs-subst">#{e.type}</span>.<span class="hljs-subst">#{e.namespace}</span>"</span>] += <span class="hljs-number">1</span>; <span class="hljs-keyword">return</span>
    handlers = { <span class="hljs-string">'some-event.some-ns'</span>: handler, <span class="hljs-string">'other-event.some-ns'</span>: handler }
<span class="hljs-function">    <span class="hljs-title">boilerplated</span> = <span class="hljs-params">(test)</span> =&gt;</span>
      <span class="hljs-property">@instance</span>.$el.<span class="hljs-literal">on</span> handlers
      test()
      <span class="hljs-property">@instance</span>.$el.trigger(<span class="hljs-string">'some-event.some-ns'</span>).trigger(<span class="hljs-string">'other-event.some-ns'</span>)
      <span class="hljs-property">@instance</span>.$el.<span class="hljs-literal">off</span>()
      <span class="hljs-keyword">return</span>

    boilerplated =&gt; <span class="hljs-property">@instance</span>.<span class="hljs-literal">off</span>(); <span class="hljs-keyword">return</span>
    assert.strictEqual handled.total(), <span class="hljs-number">0</span>,
      <span class="hljs-string">'It unbinds all events via $.fn.off.'</span>

    boilerplated =&gt;
      <span class="hljs-property">@instance</span>.<span class="hljs-literal">off</span> { <span class="hljs-string">'some-event'</span>: handler, <span class="hljs-string">'other-event'</span>: handler }
      <span class="hljs-keyword">return</span>
    assert.strictEqual handled.total(), <span class="hljs-number">0</span>,
      <span class="hljs-string">'It namespaces, unbinds from event(s)-handler map via $.fn.off.'</span>

    boilerplated =&gt; <span class="hljs-property">@instance</span>.<span class="hljs-literal">off</span>(<span class="hljs-string">'some-event'</span>, handler); <span class="hljs-keyword">return</span>
    assert.ok handled.total() <span class="hljs-keyword">is</span> <span class="hljs-number">1</span> <span class="hljs-keyword">and</span> handled[<span class="hljs-string">'other-event.some-ns'</span>] <span class="hljs-keyword">is</span> <span class="hljs-number">1</span>,
      <span class="hljs-string">'It namespaces, unbinds event(s) from handler via $.fn.off.'</span>

    boilerplated =&gt; <span class="hljs-property">@instance</span>.<span class="hljs-literal">off</span>(<span class="hljs-string">'some-event'</span>); <span class="hljs-keyword">return</span>
    assert.ok handled.total() <span class="hljs-keyword">is</span> <span class="hljs-number">2</span> <span class="hljs-keyword">and</span> handled[<span class="hljs-string">'other-event.some-ns'</span>] <span class="hljs-keyword">is</span> <span class="hljs-number">2</span>,
      <span class="hljs-string">'It namespaces, unbinds event(s) from all handlers via $.fn.off.'</span>

    <span class="hljs-property">@instance</span>.$el.<span class="hljs-literal">on</span> handlers, <span class="hljs-string">'div'</span>
    <span class="hljs-property">@instance</span>.<span class="hljs-literal">off</span> <span class="hljs-string">'some-event'</span>, <span class="hljs-string">'div'</span>, handler
    <span class="hljs-property">@instance</span>.$el.trigger(<span class="hljs-string">'some-event.some-ns'</span>).trigger(<span class="hljs-string">'other-event.some-ns'</span>)
      .find(<span class="hljs-string">'div'</span>).trigger(<span class="hljs-string">'some-event.some-ns'</span>).trigger(<span class="hljs-string">'other-event.some-ns'</span>)
    assert.ok handled.total() <span class="hljs-keyword">is</span> <span class="hljs-number">3</span> <span class="hljs-keyword">and</span> handled[<span class="hljs-string">'other-event.some-ns'</span>] <span class="hljs-keyword">is</span> <span class="hljs-number">3</span>,
      <span class="hljs-string">'It supports selector filter (event delegation) via $.fn.off.'</span>
    <span class="hljs-keyword">return</span>

  <span class="hljs-built_in">module</span> <span class="hljs-string">'hlf.mixins.selection'</span>,
    <span class="hljs-attribute">beforeEach</span>: <span class="hljs-function">-&gt;</span>
      <span class="hljs-property">@instance</span> =
        <span class="hljs-attribute">classNames</span>:
          <span class="hljs-string">'some-child'</span>: <span class="hljs-string">'js-ns-some-child'</span>
          <span class="hljs-string">'other-child'</span>: <span class="hljs-string">'js-ns-other-child'</span>
        <span class="hljs-attribute">selectors</span>:
          <span class="hljs-attribute">someChild</span>: <span class="hljs-string">'.js-ns-some-child'</span>
          <span class="hljs-attribute">otherChild</span>: <span class="hljs-string">'.js-ns-other-child'</span>
        <span class="hljs-attribute">$el</span>: $ <span class="hljs-string">"""
          &lt;div&gt;
            &lt;div class="js-ns-some-child"&gt;&lt;/div&gt;
            &lt;div class="js-ns-other-child"&gt;&lt;/div&gt;
          &lt;/div&gt;
          """</span>
      hlf.applyMixin <span class="hljs-property">@instance</span>, [], <span class="hljs-string">'selection'</span>
      <span class="hljs-keyword">return</span>

  test <span class="hljs-string">'#select'</span>, <span class="hljs-function"><span class="hljs-params">(assert)</span> -&gt;</span>
    <span class="hljs-property">@instance</span>.select()
    assert.ok <span class="hljs-property">@instance</span>.$someChild.<span class="hljs-keyword">is</span>(<span class="hljs-string">'.js-ns-some-child'</span>),
      <span class="hljs-string">"It sets a property for each 'selectors' prop-class-name pair."</span>
    assert.ok <span class="hljs-property">@instance</span>.$otherChild.<span class="hljs-keyword">is</span>(<span class="hljs-string">'.js-ns-other-child'</span>),
      <span class="hljs-string">"It sets a property for each 'selectors' prop-class-name pair."</span>
    <span class="hljs-keyword">return</span>

  test <span class="hljs-string">'#selectByClass'</span>, <span class="hljs-function"><span class="hljs-params">(assert)</span> -&gt;</span>
    assert.ok <span class="hljs-property">@instance</span>.selectByClass(<span class="hljs-string">'some-child'</span>).<span class="hljs-keyword">is</span>(<span class="hljs-string">'.js-ns-some-child'</span>),
      <span class="hljs-string">"It returns selector results using full 'classNames' value for key."</span>
    assert.ok <span class="hljs-property">@instance</span>.selectByClass(<span class="hljs-string">'other-child'</span>).<span class="hljs-keyword">is</span>(<span class="hljs-string">'.js-ns-other-child'</span>),
      <span class="hljs-string">"It returns selector results using full 'classNames' value for key."</span>
    <span class="hljs-keyword">return</span>

  <span class="hljs-literal">yes</span></div></div></div></div></body></html>